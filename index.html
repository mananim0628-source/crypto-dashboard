<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 크립토 6단계 체크리스트 실시간 대시보드 PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%); 
            color: white; 
            min-height: 100vh; 
        }
        
        .header { 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(10px); 
            padding: 20px; 
            text-align: center; 
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .header h1 { 
            font-size: 28px; 
            background: linear-gradient(45deg, #00ff88, #48cae4); 
            background-clip: text; 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }
        
        .update-status { 
            font-size: 12px; 
            color: #48cae4; 
            margin-top: 10px;
        }
        
        .api-status { 
            display: inline-block; 
            padding: 3px 8px; 
            background: rgba(0, 255, 136, 0.2); 
            color: #00ff88; 
            border-radius: 5px; 
            margin-left: 10px;
        }
        
        .api-error {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .price-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .price-card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); 
            border: 2px solid; 
            border-radius: 15px; 
            padding: 25px; 
            transition: all 0.3s;
            position: relative;
        }
        
        .price-card.bullish { 
            border-color: #00ff88; 
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2); 
        }
        
        .price-card.bearish { 
            border-color: #ff4757; 
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.2); 
        }
        
        .price-card.neutral { 
            border-color: #feca57; 
            box-shadow: 0 0 20px rgba(254, 202, 87, 0.2); 
        }
        
        .coin-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        .coin-name { 
            font-size: 20px; 
            font-weight: bold; 
            display: flex;
            align-items: center;
        }
        
        .coin-score {
            font-size: 16px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 8px;
            background: rgba(72, 202, 228, 0.2);
            color: #48cae4;
        }
        
        .coin-price { 
            font-size: 32px; 
            font-weight: bold; 
            color: #00ff88; 
            margin: 15px 0; 
        }
        
        .price-change { 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: bold; 
            display: inline-block; 
            margin-bottom: 15px;
        }
        
        .bullish .price-change { 
            background: rgba(0, 255, 136, 0.2); 
            color: #00ff88; 
        }
        
        .bearish .price-change { 
            background: rgba(255, 71, 87, 0.2); 
            color: #ff4757; 
        }
        
        .neutral .price-change { 
            background: rgba(254, 202, 87, 0.2); 
            color: #feca57; 
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            margin: 20px;
            border-radius: 10px;
            font-size: 12px;
            color: #666;
            display: block;
        }
        
        @media (max-width: 768px) {
            .price-cards { 
                grid-template-columns: 1fr; 
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 크립토 6단계 체크리스트 실시간 대시보드 PRO</h1>
        <div class="update-status">
            마지막 업데이트: <span id="lastUpdate">-</span> | 다음 업데이트: <span id="countdown">60</span>초
            <span class="api-status" id="apiStatus">API 연결중...</span>
        </div>
    </div>

    <div class="container">
        <div id="debugInfo" class="debug-info">
            <strong>디버그 정보:</strong><br>
            API 상태: <span id="debugApiStatus">확인중...</span><br>
            마지막 요청: <span id="debugLastRequest">-</span><br>
            응답 데이터: <span id="debugResponse">-</span>
        </div>
        
        <div id="coreCoinsCards" class="price-cards"></div>
    </div>

    <script>
        const API_KEY = 'CG-AJku92n1VmZV1ZQ2mp46DA2C';
        const API_BASE_URL = 'https://api.coingecko.com/api/v3';
        let countdown = 60;
        let coreCoinsData = [];
        let isApiWorking = false;
        let updateInterval;
        let countdownInterval;
        
        const CORE_COINS = ['bitcoin', 'ethereum', 'ripple', 'binancecoin'];

        function updateDebugInfo(status, request, response) {
            const debugApiStatus = document.getElementById('debugApiStatus');
            const debugLastRequest = document.getElementById('debugLastRequest');
            const debugResponse = document.getElementById('debugResponse');
            
            if (debugApiStatus) debugApiStatus.textContent = status;
            if (debugLastRequest) debugLastRequest.textContent = request;
            if (debugResponse) debugResponse.textContent = response;
        }

        async function fetchCoreCoins() {
    console.log('📈 핵심 코인 데이터 요청 시작...');
    try {
        // Pro API는 다른 파라미터명을 사용할 수 있음
        const url = `https://pro-api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,ripple,binancecoin&vs_currencies=usd&include_24hr_change=true`;
        
        const response = await fetch(url, {
            headers: {
                'Accept': 'application/json',
                'X-Cg-Pro-Api-Key': 'CG-AJku92n1VmZV1ZQ2mp46DA2C'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('핵심 코인 API 응답:', data);
        
        if (!data || Object.keys(data).length === 0) {
            throw new Error('빈 응답 데이터');
        }
        
        coreCoinsData = [
            {
                id: 'bitcoin',
                symbol: 'BTC',
                name: 'Bitcoin',
                icon: '🔥',
                price: data.bitcoin?.usd || 0,
                change: data.bitcoin?.usd_24h_change || 0,
                volume: data.bitcoin?.usd_24h_vol || 0,
                marketCap: data.bitcoin?.usd_market_cap || 0
            },
            {
                id: 'ethereum',
                symbol: 'ETH',
                name: 'Ethereum',
                icon: '⭐',
                price: data.ethereum?.usd || 0,
                change: data.ethereum?.usd_24h_change || 0,
                volume: data.ethereum?.usd_24h_vol || 0,
                marketCap: data.ethereum?.usd_market_cap || 0
            },
            {
                id: 'ripple',
                symbol: 'XRP',
                name: 'Ripple',
                icon: '💎',
                price: data.ripple?.usd || 0,
                change: data.ripple?.usd_24h_change || 0,
                volume: data.ripple?.usd_24h_vol || 0,
                marketCap: data.ripple?.usd_market_cap || 0
            },
            {
                id: 'binancecoin',
                symbol: 'BNB',
                name: 'Binance',
                icon: '🪙',
                price: data.binancecoin?.usd || 0,
                change: data.binancecoin?.usd_24h_change || 0,
                volume: data.binancecoin?.usd_24h_vol || 0,
                marketCap: data.binancecoin?.usd_market_cap || 0
            }
        ].filter(coin => coin.price > 0);
        
        console.log('처리된 핵심 코인 데이터:', coreCoinsData);
        return coreCoinsData;
        
    } catch (error) {
        console.error('핵심 코인 데이터 에러:', error);
        throw error;
    }
}

        async function fetchAllCryptoData() {
            const timestamp = new Date().toLocaleTimeString();
            updateDebugInfo('요청 중...', timestamp, '-');
            
            console.log('🚀 전체 크립토 데이터 업데이트 시작');
            
            try {
                await fetchCoreCoins();
                
                isApiWorking = true;
                document.getElementById('apiStatus').textContent = 'API ✅ PRO';
                document.getElementById('apiStatus').className = 'api-status';
                
                updateDebugInfo('성공', timestamp, `핵심: ${coreCoinsData.length}개`);
                console.log('✅ 전체 데이터 업데이트 완료');
                
            } catch (error) {
                console.error('❌ 전체 데이터 업데이트 에러:', error);
                updateDebugInfo(`에러: ${error.message}`, timestamp, '-');
                document.getElementById('apiStatus').textContent = 'API ❌';
                document.getElementById('apiStatus').className = 'api-status api-error';
                isApiWorking = false;
            }
        }
        
        function calculateCoinScore(coin) {
            let score = 0;
            
            if (coin.symbol === 'BTC' && coin.price > 95000) score += 20;
            else if (coin.symbol === 'ETH' && coin.price > 3500) score += 18;
            else if (coin.price > 0) score += 15;
            
            if (coin.change > 5) score += 25;
            else if (coin.change > 2) score += 20;
            else if (coin.change > 0) score += 15;
            else if (coin.change > -2) score += 10;
            else score += 5;
            
            return Math.min(140, Math.max(0, score));
        }
        
        function getStrategyDirection(coinScore, change) {
            if (coinScore >= 100 && change > 0) {
                return { direction: 'LONG', class: 'long-strategy', signal: '📈 강력 매수' };
            } else if (coinScore >= 80 && change > -1) {
                return { direction: 'LONG', class: 'long-strategy', signal: '📈 매수' };
            } else if (coinScore <= 40 && change < -2) {
                return { direction: 'SHORT', class: 'short-strategy', signal: '📉 매도/숏' };
            } else if (coinScore <= 60 && change < 0) {
                return { direction: 'SHORT', class: 'short-strategy', signal: '📉 약세' };
            } else {
                return { direction: 'HOLD', class: 'hold-strategy', signal: '⚖️ 관망' };
            }
        }
        
        function formatPrice(price) {
            if (!price || price === 0) return '0';
            if (price > 1000) return '$' + price.toLocaleString();
            if (price > 1) return '$' + price.toFixed(2);
            return '$' + price.toFixed(4);
        }
        
        function createCoinCard(coin) {
            const coinScore = calculateCoinScore(coin);
            const strategy = getStrategyDirection(coinScore, coin.change);
            
            let cardClass = 'neutral';
            if (strategy.direction === 'LONG') cardClass = 'bullish';
            else if (strategy.direction === 'SHORT') cardClass = 'bearish';
            
            return `
                <div class="price-card ${cardClass}">
                    <div class="coin-header">
                        <div class="coin-name">
                            ${coin.icon} ${coin.symbol}
                        </div>
                        <div class="coin-score">${coinScore}/140</div>
                    </div>
                    <div class="coin-price">
                        ${formatPrice(coin.price)}
                    </div>
                    <div class="price-change">
                        ${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(2)}%
                    </div>
                </div>
            `;
        }
        
        function renderCoreCoinsCards() {
            console.log('🎯 핵심 코인 카드 렌더링...');
            const container = document.getElementById('coreCoinsCards');
            
            if (!coreCoinsData || coreCoinsData.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;">핵심 코인 데이터를 로딩중입니다...</div>';
                return;
            }
            
            let html = '';
            coreCoinsData.forEach(coin => {
                html += createCoinCard(coin);
            });
            
            container.innerHTML = html;
            console.log('✅ 핵심 코인 카드', coreCoinsData.length, '개 렌더링 완료');
        }
        
        async function updateDashboard() {
            console.log('🚀 대시보드 전체 업데이트 시작...');
            
            await fetchAllCryptoData();
            renderCoreCoinsCards();
            
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ko-KR');
            
            console.log('✅ 대시보드 전체 업데이트 완료!');
        }
        
        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    countdown = 60;
                    updateDashboard();
                }
                document.getElementById('countdown').textContent = countdown;
            }, 1000);
        }
        
        async function init() {
            console.log('🎬 앱 초기화 시작...');
            
            await updateDashboard();
            startCountdown();
            
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            updateInterval = setInterval(updateDashboard, 300000);
            
            console.log('🎉 앱 초기화 완료!');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('📄 DOM 로드 완료, 앱 시작...');
            init();
        });

        window.addEventListener('beforeunload', () => {
            if (updateInterval) clearInterval(updateInterval);
            if (countdownInterval) clearInterval(countdownInterval);
        });

        window.addEventListener('error', (event) => {
            console.error('❌ 전역 에러:', event.error);
            updateDebugInfo('에러 발생', new Date().toLocaleTimeString(), event.error.message);
        });
    </script>
</body>
</html>